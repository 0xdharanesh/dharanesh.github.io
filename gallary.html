<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Portfolio Gallery</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                text-align: center;
            }

            .gallery {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
            }

            .gallery img {
                width: 200px;
                height: auto;
                border-radius: 8px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }

            .certificate-list {
                display: flex;
                gap: 10px;
                justify-content: center;
                margin-top: 20px;
                overflow-x: scroll;
                padding: 10px;
                border: 1px solid #ccc;
                border-radius: 8px;
            }

            .certificate-item {
                flex-shrink: 0;
                padding: 10px;
                border-radius: 8px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }

            .certificate-item p {
                margin: 0;
            }
        </style>
    </head>

    <body>
        <h1>My Portfolio Gallery</h1>

        <!-- Image Gallery Section -->
        <div class="gallery" id="gallery"></div>

        <!-- Certificates Section -->
        <h2>Certificates</h2>
        <div class="certificate-list" id="certificateList"></div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>

        <script>
            const folderIds = {
                photos: "1U1PiyXsOYeS3BEj58un29f2XMtYb5RhA", // Photos folder ID
                certificates: "1zJPPsZIjU11ZOx7yzGPDKFZXPeGgjHSW", // Certificates folder ID
            };
            const apiKey = "AIzaSyB8P_hvbRkqHa4ijc8sxD9WSjN1o1kryfs"; // API Key

            // Fetching files from a given folder
            async function fetchFiles(folderId) {
                const url = `https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents&key=${apiKey}&fields=files(id,name,mimeType,description)`;
                const response = await fetch(url);
                return await response.json();
            }

            // Display images in the gallery
            async function displayGallery() {
                const data = await fetchFiles(folderIds.photos);
                const galleryDiv = document.getElementById("gallery");

                data.files.forEach((file) => {
                    if (file.mimeType.startsWith("image/")) {
                        const img = document.createElement("img");
                        img.src = `https://lh3.googleusercontent.com/d/${file.id}`;
                        img.alt = file.name;
                        const imgContainer = document.createElement("div");
                        imgContainer.appendChild(img);

                        // Fetch the description from the file's metadata
                        const description = document.createElement("p");
                        description.innerText = file.description || `No description available for ${file.name}`;
                        imgContainer.appendChild(description);

                        galleryDiv.appendChild(imgContainer);
                    }
                });
            }

            // Convert PDF to image using PDF.js and display one image at a time
            // async function displayCertificates() {
            //     const data = await fetchFiles(folderIds.certificates);
            //     const certificateListDiv = document.getElementById("certificateList");

            //     for (const file of data.files) {
            //         if (file.mimeType === "application/pdf") {
            //             const certificateItem = document.createElement("div");
            //             certificateItem.className = "certificate-item";

            //             const certificateTitle = document.createElement("p");
            //             certificateTitle.innerText = file.name;
            //             certificateItem.appendChild(certificateTitle);

            //             // Create canvas element for the PDF rendering
            //             const canvas = document.createElement("canvas");
            //             certificateItem.appendChild(canvas);

            //             // Fetch the PDF as a Blob using Google Drive API
            //             // const pdfUrl = `https://www.googleapis.com/drive/v3/files/${file.id}?alt=media&key=${apiKey}`;
            //             // img.src = `https://lh3.googleusercontent.com/d/${file.id}`;
            //             const pdfUrl = `https://lh3.googleusercontent.com/d/${file.id}`;
            //             const response = await fetch(pdfUrl);
            //             const blob = await response.blob();

            //             // Pass the Blob URL to PDF.js for rendering
            //             const objectURL = URL.createObjectURL(blob);
            //             const pdf = await pdfjsLib.getDocument(objectURL).promise;

            //             // Rendering the first page (you can change this to render more pages)
            //             const page = await pdf.getPage(1);
            //             const viewport = page.getViewport({ scale: 1 });
            //             const context = canvas.getContext("2d");
            //             canvas.width = viewport.width;
            //             canvas.height = viewport.height;
            //             await page.render({ canvasContext: context, viewport: viewport }).promise;

            //             certificateListDiv.appendChild(certificateItem);
            //         }
            //     }
            // }

            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js';

            async function displayCertificates() {
                const data = await fetchFiles(folderIds.certificates);
                const certificateListDiv = document.getElementById("certificateList");

                for (const file of data.files) {
                    if (file.mimeType === "application/pdf") {
                        const certificateItem = document.createElement("div");
                        certificateItem.className = "certificate-item";

                        const certificateTitle = document.createElement("p");
                        certificateTitle.innerText = file.name;
                        certificateItem.appendChild(certificateTitle);

                        const canvas = document.createElement("canvas");
                        certificateItem.appendChild(canvas);

                        // Fetch the PDF file from Google Drive
                        const pdfUrl = `https://www.googleapis.com/drive/v3/files/${file.id}?alt=media&key=${apiKey}`;
                        try {
                            const response = await fetch(pdfUrl);
                            if (!response.ok) throw new Error("Failed to fetch PDF");

                            const blob = await response.blob();
                            const objectURL = URL.createObjectURL(blob);

                            // Load and render the PDF using PDF.js
                            const pdf = await pdfjsLib.getDocument(objectURL).promise;
                            const page = await pdf.getPage(1); // Get the first page
                            const viewport = page.getViewport({ scale: 1 });
                            const context = canvas.getContext("2d");
                            canvas.width = viewport.width;
                            canvas.height = viewport.height;

                            await page.render({
                                canvasContext: context,
                                viewport: viewport,
                            }).promise;

                            certificateListDiv.appendChild(certificateItem);
                        } catch (error) {
                            console.error("Error loading PDF:", error);
                        }
                    }
                }
            }


            // Initialize both displays
            displayGallery();
            displayCertificates();
        </script>
    </body>

</html>